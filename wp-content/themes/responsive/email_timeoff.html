<?php
/*
Template Name: Time-Off Confirmation
*/
if(isset($_POST['email'])) {
         
    function died($error) {
        // your error code can go here
        echo "We are very sorry, but there were error(s) found with the form you submitted. ";
        echo "These errors appear below.<br /><br />";
        echo $error."<br /><br />";
        echo "Please go back and fix these errors.<br /><br />";
        die();
    }
	
	function clean_string($string) {
      $bad = array("content-type","bcc:","to:","cc:","href");
      return str_replace($bad,"",$string);
    }
     
    // validation expected data exists
    if(!isset($_POST['employee']) ||
        !isset($_POST['date_submitted']) ||
        !isset($_POST['pay_type']) ||
     	 !isset($_POST['datefrom']) ||
    	 !isset($_POST['dateto']) ||
    	 !isset($_POST['reason']) ||
      	 !isset($_POST['email']) ||
    	 !isset($_POST['requesting']) ||
        !isset($_POST['supervisor'])) {
        died('We are sorry, but there appears to be a problem with the form you submitted.');      
    }
	
	// EDIT THE 2 LINES BELOW AS REQUIRED
    $email_to      = 'timeoff@epgmediallc.com';
    $email_subject = 'SCHEDULED AND UNSCHEDULED TIME OFF REQUEST FORM';
    
	// set vars
    $employee       = $_POST['employee']; 
	$date_submitted = $_POST['date_submitted'];
    $pay_type       = $_POST['pay_type'];      
	$days_or_hours  = $_POST['hours']; 
    $datefrom       = $_POST['datefrom']; 
    $dateto         = $_POST['dateto'];    
    $reason         = $_POST['reason']; 
	$email_from     = $_POST['email']; 
	$requesting     = $_POST['requesting']; 
	$supervisor     = $_POST['supervisor']; 
     
    $error_message = "";
    $email_exp = '/^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/';
	if(!preg_match($email_exp,$email_from)) {
		$error_message .= 'The Email Address you entered does not appear to be valid.<br />';
	}
	
	if(!preg_match($email_exp,$supervisor)) {
		$error_message .= 'The Supervisor Email Address does not appear to be valid.<br />';
	}
	
    $string_exp = "/^[A-Za-z .'-]+$/";
    if(!preg_match($string_exp,$employee)) {
      $error_message .= 'The First Name you entered does not appear to be valid.<br />';
    }
	
    if(strlen($reason) < 2) {
		$error_message .= 'The Reason you entered does not appear to be valid text.<br />';
    }
	
    if(strlen($error_message) > 0) {
		died($error_message);
    }
	
    $email_message = "Form details below.\n\n";
          
    $reason = clean_string($reason);
	$email_message .= <<<MSG
This is a copy of the Time Off Request Form sent by $employee
Supervisors: to approve this request press 'Reply to All' and type APPROVED then press 'Send'

From
Employee Name: $employee
Email Address: $email
Date submitted: $date_submitted

Requesting $requesting hours of $pay_type time off.
Beginning $datefrom to $dateto.

The reason for this request:
$reason
MSG;
     
// create email headers
$headers = 'From: '.$email_from."\r\n".
'Reply-To: '.$email_from."\r\n" .
'Cc: '.$supervisor."\r\n" .
'Bcc: '.$email_from."\r\n" .
'X-Mailer: PHP/' . phpversion();
@mail($email_to, $email_subject, $email_message, $headers); 
?>
<!-- 
	include success html here 
-->
<html>
	<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
	<title>Time off Request - Thank You</title>
	<link href="timeoff.css" rel="stylesheet" type="text/css">
	<script src="jquery-1.10.2.js" type="text/javascript"></script>
	
	<script src="floatlabels.min.js" type="text/javascript"></script>
	<!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
	<body>
		<h1>EPG Media, LLC <span>scheduled and unsheduled time off request form</span></h1>
		<div class="timeOffWrap">
			<h2>Thank You</h2>
			<div class="innerwrap">
				<h3>
					Please verify the entries from your submission.
				</h3>
				<p>
					Date submitted: <span><?php echo $date_submitted; ?></span>
				</p>
				<p>
					Thank you <span><?php echo $employee; ?></span>. Your email address is: <span><?php echo $email; ?></span>
				</p>
				<p>
					You are requesting <?php echo $requesting . ' hours'; ?> of <span><?php echo $pay_type; ?></span> time off from <span><?php echo $datefrom; ?></span> to <span><?php echo $dateto; ?></span>.
				<h3>The reason for this request:</h3>
				<p>
					<?php echo $reason; ?>
				</p>
				<p>
					Your request has been sent to <span><?php echo $supervisor; ?></span>.
				</p>
				<p>Thank You!</p>
				<p>
					<a href="javascript:history.go(-1);">To Return to form</a>					
				</p>
			</div>			
		</div>
	</body>
</html>
 
<?php
}
?>